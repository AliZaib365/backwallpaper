<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Wallpaper Hub</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #1e3c72;
      --primary-light: #2a5298;
      --secondary: #ee9ca7;
      --accent: #ea5455;
      --light: #f9fafb;
      --dark: #212529;
      --gray: #768390;
      --success: #58b368;
      --border-radius: 20px;
      --card-shadow: 0 8px 30px rgba(30,60,114,0.12);
      --transition: all 0.3s cubic-bezier(.77,0,.18,1);
      --gradient-bg: linear-gradient(135deg, #232526 0%, #414345 100%);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: white;
      color: var(--dark);
      line-height: 1.6;
      padding: 20px;
      min-height: 100vh;
    }
    .app-container { max-width: 1300px; margin: 0 auto; }
    header { text-align: center; margin-bottom: 40px; position: relative; }
    .logo {
      display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 15px;
    }
    .logo i {
      font-size: 38px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    h1 {
      background: linear-gradient(135deg, var(--secondary) 0%, var(--primary) 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      font-size: 2.8rem; font-weight: 900; margin: 0; letter-spacing: -0.5px;
    }
    .subtitle { color: var(--gray); font-size: 1.15rem; margin-top: 8px; font-weight: 400; }
    .main-content { display: grid; grid-template-columns: 1fr 2.2fr; gap: 35px; }
    @media (max-width: 950px) { .main-content { grid-template-columns: 1fr; } }
    .upload-section, .gallery-section {
      background: rgba(255, 255, 255, 0.96);
      backdrop-filter: blur(8px);
      border-radius: var(--border-radius);
      box-shadow: var(--card-shadow);
      padding: 32px;
      transition: var(--transition);
      border: 1px solid #e6e8f0;
    }
    .upload-section:hover, .gallery-section:hover {
      box-shadow: 0 20px 40px rgba(30,60,114,0.15);
      transform: translateY(-5px);
    }
    .section-title {
      color: var(--primary); font-size: 1.6rem; margin-bottom: 25px; padding-bottom: 15px;
      border-bottom: 2px solid rgba(30,60,114,0.09); display: flex; align-items: center; gap: 12px; font-weight: 700;
    }
    .section-title i {
      font-size: 1.4rem;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    .form-group { margin-bottom: 25px; position: relative; }
    label { display: block; margin-bottom: 10px; font-weight: 600; color: var(--primary); font-size: 1.05rem; }
    select, input[type="text"], input[type="file"] {
      width: 100%; padding: 15px 18px; border-radius: 12px; border: 1.5px solid #e0e8ff;
      background: #f7fafd; font-size: 1rem; transition: var(--transition);
      box-shadow: inset 0 2px 4px rgba(30,60,114,0.03);
    }
    select:focus, input[type="text"]:focus {
      outline: none; border-color: var(--primary-light);
      box-shadow: 0 0 0 4px #e0e8ff; transform: translateY(-2px);
    }
    .file-input-container {
      position: relative; overflow: hidden; border-radius: 12px; background: #f7fafd;
      border: 2px dashed #d7e3fc; padding: 30px 20px; text-align: center; cursor: pointer; transition: var(--transition);
    }
    .file-input-container:hover { border-color: var(--primary); background: #f0f4ff; transform: translateY(-3px); }
    .file-input-container.dragover { background: var(--primary-light); border-color: var(--primary); }
    .file-input-container.dragover i, .file-input-container.dragover .file-input-label, .file-input-container.dragover .file-input-hint { color: white; }
    .file-input-container i { font-size: 2.5rem; color: var(--primary-light); margin-bottom: 15px; transition: var(--transition); }
    .file-input-label { font-weight: 700; color: var(--primary); margin-bottom: 8px; font-size: 1.1rem; transition: var(--transition); }
    .file-input-hint { color: var(--gray); font-size: 0.95rem; transition: var(--transition); }
    input[type="file"] { position: absolute; left: 0; top: 0; opacity: 0; width: 100%; height: 100%; cursor: pointer; }
    .preview-container { margin-top: 25px; max-height: 300px; overflow-y: auto; padding-right: 5px; }
    .preview-container::-webkit-scrollbar { width: 6px; }
    .preview-container::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
    .preview-container::-webkit-scrollbar-thumb { background: var(--primary-light); border-radius: 10px; }
    .preview-item {
      background: #f3f6fb; border-radius: 12px; padding: 18px; margin-bottom: 18px;
      border: 1px solid #e9eef7; transition: var(--transition);
    }
    .preview-item:hover { transform: translateX(5px); box-shadow: 0 5px 15px rgba(30,60,114,0.05); }
    .preview-header { display: flex; align-items: center; margin-bottom: 12px; }
    .preview-thumb {
      width: 70px; height: 70px; object-fit: cover; border-radius: 10px; margin-right: 15px;
      box-shadow: 0 4px 8px rgba(30,60,114,0.10); transition: var(--transition);
    }
    .preview-thumb:hover { transform: scale(1.05); }
    .preview-title-input {
      flex: 1; padding: 12px 15px; border-radius: 8px; border: 1.5px solid #e0e8ff;
      font-size: 1rem; transition: var(--transition);
    }
    .preview-title-input:focus { outline: none; border-color: var(--primary-light); box-shadow: 0 0 0 3px #e0e8ff77; }
    .btn {
      display: inline-flex; align-items: center; justify-content: center; gap: 10px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      color: white; border: none; border-radius: 12px; padding: 16px 28px; font-size: 1.1rem;
      font-weight: 700; cursor: pointer; transition: var(--transition); width: 100%;
      box-shadow: 0 10px 20px rgba(30,60,114,0.18);
    }
    .btn:hover { background: linear-gradient(135deg, var(--secondary) 0%, var(--primary) 100%);
      transform: translateY(-3px); box-shadow: 0 15px 30px rgba(30,60,114,0.23); }
    .btn:active { transform: translateY(0); }
    .btn i { font-size: 1.2rem; }
    .gallery-controls { display: flex; gap: 12px; margin-bottom: 25px; flex-wrap: wrap; }
    .filter-btn {
      padding: 10px 20px; background: white; border: 1.5px solid #e0e8ff; border-radius: 10px;
      cursor: pointer; transition: var(--transition); font-weight: 600;
      box-shadow: 0 4px 6px rgba(30,60,114,0.04);
    }
    .filter-btn.active, .filter-btn:hover {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      color: white; border-color: var(--primary); transform: translateY(-2px);
      box-shadow: 0 7px 14px rgba(30,60,114,0.14);
    }
    .gallery-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px;
    }
    .gallery-item {
      background: white; border-radius: var(--border-radius); overflow: hidden;
      box-shadow: 0 8px 20px rgba(30,60,114,0.09); transition: var(--transition); position: relative;
    }
    .gallery-item:hover { transform: translateY(-8px) scale(1.02); box-shadow: 0 20px 40px rgba(30,60,114,0.15); z-index: 2; }
    .gallery-media { width: 100%; height: 200px; object-fit: cover; display: block; transition: var(--transition); background: #f7fafd;}
    .gallery-item:hover .gallery-media { transform: scale(1.05); }
    .gallery-info { padding: 20px; }
    .gallery-title { font-weight: 800; color: var(--primary); margin-bottom: 10px; font-size: 1.15rem; line-height: 1.3; }
    .gallery-category { display: flex; justify-content: space-between; align-items: center; color: var(--gray); font-size: 0.95rem; }
    .gallery-type {
      position: absolute; top: 15px; right: 15px; background: rgba(0, 0, 0, 0.72); color: white;
      padding: 5px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; backdrop-filter: blur(4px);
    }
    .empty-state {
      text-align: center; padding: 60px 20px; color: var(--gray); grid-column: 1 / -1;
    }
    .empty-state i { font-size: 4rem; margin-bottom: 20px; color: #e6e9ff; opacity: 0.7; }
    .empty-state h3 { font-size: 1.5rem; margin-bottom: 10px; color: var(--gray); }
    .category-badge {
      background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary) 100%);
      color: white; padding: 5px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600;
    }
    .tabs {
      display: flex; margin-bottom: 25px; background: #f1f2f6; border-radius: 12px; padding: 6px;
      box-shadow: 0 4px 6px rgba(30,60,114,0.03);
    }
    .tab {
      flex: 1; text-align: center; padding: 12px; cursor: pointer; border-radius: 10px; transition: var(--transition); font-weight: 600;
    }
    .tab.active {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      color: white; box-shadow: 0 4px 10px rgba(30,60,114,0.14);
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .gallery-item { animation: fadeIn 0.5s ease forwards; }
    .toast {
      position: fixed; bottom: 30px; right: 30px; padding: 15px 25px; background: var(--success);
      color: white; border-radius: 10px; box-shadow: 0 10px 25px rgba(30,60,114,0.12);
      display: flex; align-items: center; gap: 10px; z-index: 1000; animation: slideIn 0.3s ease forwards;
    }
    @keyframes slideIn {
      from { transform: translateX(100px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    .toast.error { background: var(--accent); }
    @media (max-width: 768px) {
      h1 { font-size: 2.2rem; }
      .gallery-grid { grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 15px; }
      .gallery-media { height: 160px; }
    }
    @media (max-width: 480px) {
      body { padding: 15px; }
      .upload-section, .gallery-section { padding: 20px; }
      .gallery-grid { grid-template-columns: 1fr; }
      .gallery-controls { justify-content: center; }
    }
    .logout-link {
      position: absolute; top: 22px; right: 26px;
      color: var(--primary); font-weight: 700; text-decoration: none;
      background: rgba(255,255,255,0.80); padding: 7px 18px;
      border-radius: 8px; box-shadow: 0 2px 8px #23252614; font-size: 1rem;
      transition: background 0.15s, color 0.15s;
    }
    .logout-link:hover { background: var(--primary); color: #fff; }
    /* Pagination styling */
    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
      margin-top: 30px;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    .pagination-btn {
      background: white;
      border: 1.5px solid #e0e8ff;
      color: var(--primary);
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 1.05rem;
      cursor: pointer;
      transition: var(--transition);
      font-weight: 700;
      min-width: 38px;
    }
    .pagination-btn.active, .pagination-btn:hover {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      color: white;
      border-color: var(--primary);
      transform: translateY(-2px);
      box-shadow: 0 7px 14px rgba(30,60,114,0.14);
    }
    .pagination-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <div class="app-container">
    <header>
      <div class="logo">
        <i class="fas fa-image"></i>
        <h1>Wallpaper Hub</h1>
      </div>
      <a href="/logout" class="logout-link"><i class="fas fa-sign-out-alt"></i> Logout</a>
      <p class="subtitle">Upload and organize your favorite wallpapers</p>
    </header>

    <div class="main-content">
      <section class="upload-section">
        <h2 class="section-title"><i class="fas fa-upload"></i> Upload New</h2>
        <form id="uploadForm">
          <div class="form-group">
            <label for="mainCategory">Main Category</label>
            <select id="mainCategory" required></select>
          </div>
          <div class="form-group">
            <label for="subCategory">Subcategory</label>
            <select id="subCategory" required></select>
          </div>
          <div class="tabs">
            <div class="tab active" data-type="static">Static</div>
            <div class="tab" data-type="live">Live</div>
          </div>
          <input type="hidden" id="wallpaperType" value="static">
          <div class="form-group">
            <div class="file-input-container" id="fileDropArea">
              <i class="fas fa-cloud-upload-alt"></i>
              <div class="file-input-label">Select Wallpaper Files</div>
              <div class="file-input-hint">Click to browse or drag & drop</div>
              <input type="file" id="wallpaperFiles" name="files" multiple required>
            </div>
          </div>
          <div id="titlesPreview" class="preview-container"></div>
          <button type="submit" class="btn">
            <i class="fas fa-paper-plane"></i> Upload Wallpapers
          </button>
        </form>
      </section>
      <section class="gallery-section">
        <h2 class="section-title"><i class="fas fa-images"></i> Gallery</h2>
        <div class="gallery-controls">
          <div class="filter-btn active" data-filter="all">All</div>
          <div class="filter-btn" data-filter="static">Static</div>
          <div class="filter-btn" data-filter="live">Live</div>
        </div>
        <div id="galleryItems" class="gallery-grid">
          <div class="empty-state">
            <i class="fas fa-inbox"></i>
            <h3>No wallpapers yet</h3>
            <p>Upload your first wallpaper to get started</p>
          </div>
        </div>
        <div id="paginationControls" class="pagination"></div>
      </section>
    </div>
  </div>
<script>
  // DOM Elements
  const mainCategorySelect = document.getElementById('mainCategory');
  const subCategorySelect = document.getElementById('subCategory');
  const wallpaperTypeInput = document.getElementById('wallpaperType');
  const wallpaperFilesInput = document.getElementById('wallpaperFiles');
  const titlesPreviewDiv = document.getElementById('titlesPreview');
  const uploadForm = document.getElementById('uploadForm');
  const galleryItemsDiv = document.getElementById('galleryItems');
  const tabs = document.querySelectorAll('.tab');
  const filterButtons = document.querySelectorAll('.filter-btn');
  const fileDropArea = document.getElementById('fileDropArea');
  const paginationControls = document.getElementById('paginationControls');
  let currentFilter = 'all';
  let wallpapers = [];
  let flatWallpapers = [];
  let currentPage = 1;
  const itemsPerPage = 4;

  function showToast(message, isError = false) {
    const toast = document.createElement('div');
    toast.className = `toast ${isError ? 'error' : ''}`;
    toast.innerHTML = `<i class="fas ${isError ? 'fa-exclamation-circle' : 'fa-check-circle'}"></i><span>${message}</span>`;
    document.body.appendChild(toast);
    setTimeout(() => { toast.style.opacity = '0'; setTimeout(() => toast.remove(), 300); }, 3000);
  }

  fetch('/api/main-categories')
    .then(response => response.json())
    .then(data => {
      mainCategorySelect.innerHTML = '<option value="">Select Main Category</option>' +
        data.map(c => `<option value="${c._id}">${c.name}</option>`).join('');
    })
    .catch(error => {
      console.error('Error fetching categories:', error);
      showToast('Failed to load categories', true);
    });

  mainCategorySelect.addEventListener('change', function() {
    if (!this.value) {
      subCategorySelect.innerHTML = '<option value="">Select Subcategory</option>';
      return;
    }
    fetch(`/api/sub-categories?mainCategory=${this.value}`)
      .then(response => response.json())
      .then(data => {
        subCategorySelect.innerHTML = '<option value="">Select Subcategory</option>' +
          data.map(s => `<option value="${s._id}">${s.name}</option>`).join('');
      })
      .catch(error => {
        console.error('Error fetching subcategories:', error);
        showToast('Failed to load subcategories', true);
      });
  });

  tabs.forEach(tab => {
    tab.addEventListener('click', function() {
      const type = this.getAttribute('data-type');
      tabs.forEach(t => t.classList.remove('active'));
      this.classList.add('active');
      wallpaperTypeInput.value = type;
      wallpaperFilesInput.value = "";
      titlesPreviewDiv.innerHTML = "";
      wallpaperFilesInput.accept = type === "static" ? "image/*" : "video/*";
    });
  });

  ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
    fileDropArea.addEventListener(eventName, preventDefaults, false);
  });
  function preventDefaults(e) { e.preventDefault(); e.stopPropagation(); }
  ['dragenter', 'dragover'].forEach(eventName => {
    fileDropArea.addEventListener(eventName, highlight, false);
  });
  ['dragleave', 'drop'].forEach(eventName => {
    fileDropArea.addEventListener(eventName, unhighlight, false);
  });
  function highlight() { fileDropArea.classList.add('dragover'); }
  function unhighlight() { fileDropArea.classList.remove('dragover'); }
  fileDropArea.addEventListener('drop', handleDrop, false);
  function handleDrop(e) {
    const dt = e.dataTransfer;
    const files = dt.files;
    wallpaperFilesInput.files = files;
    handleFiles(files);
  }

  wallpaperFilesInput.addEventListener('change', function() { handleFiles(this.files); });

  function handleFiles(files) {
    titlesPreviewDiv.innerHTML = "";
    const fileList = Array.from(files);
    const type = wallpaperTypeInput.value;
    if (type === "static" && fileList.some(f => !f.type.startsWith("image/"))) {
      showToast("Static wallpaper must be images only.", true); this.value = ""; return;
    }
    if (type === "live" && fileList.some(f => !f.type.startsWith("video/"))) {
      showToast("Live wallpaper must be videos only.", true); this.value = ""; return;
    }
    const maxSize = 8 * 1024 * 1024;
    if (fileList.some(f => f.size > maxSize)) {
      showToast("Each file must be less than 8 MB.", true); this.value = ""; return;
    }
    fileList.forEach((file, index) => {
      const previewItem = document.createElement('div');
      previewItem.className = 'preview-item';
      previewItem.style.animation = `fadeIn 0.5s ease ${index * 0.1}s forwards`;
      previewItem.style.opacity = 0;
      previewItem.innerHTML = `
        <div class="preview-header">
          ${type === "static"
            ? `<img class="preview-thumb" src="${URL.createObjectURL(file)}" alt="Preview">`
            : `<video class="preview-thumb" src="${URL.createObjectURL(file)}" muted></video>`
          }
          <input type="text" class="preview-title-input" name="title_${index}"
                 value="${file.name.replace(/\.[^/.]+$/, '')}"
                 placeholder="Enter title" required>
        </div>
      `;
      titlesPreviewDiv.appendChild(previewItem);
      if (type === "static") {
        const img = previewItem.querySelector('img');
        img.onload = () => URL.revokeObjectURL(img.src);
      } else {
        const video = previewItem.querySelector('video');
        video.onloadeddata = () => URL.revokeObjectURL(video.src);
      }
    });
  }

  uploadForm.addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData();
    formData.append('mainCategory', mainCategorySelect.value);
    formData.append('subCategory', subCategorySelect.value);
    formData.append('type', wallpaperTypeInput.value);
    const files = Array.from(wallpaperFilesInput.files);
    const titles = [];
    for (let i = 0; i < files.length; i++) {
      const titleInput = document.querySelector(`input[name="title_${i}"]`);
      titles.push(titleInput.value);
      formData.append('files', files[i]);
    }
    formData.append('titles', JSON.stringify(titles));
    const submitBtn = this.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploading...';
    submitBtn.disabled = true;
    fetch('/api/wallpapers', { method: 'POST', body: formData })
      .then(response => response.json())
      .then(data => {
        showToast('Upload successful!');
        wallpaperFilesInput.value = "";
        titlesPreviewDiv.innerHTML = "";
        uploadForm.reset();
        loadGallery();
      })
      .catch(error => {
        console.error('Error uploading:', error);
        showToast('Upload failed. Please try again.', true);
      })
      .finally(() => {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
      });
  });

  filterButtons.forEach(button => {
    button.addEventListener('click', function() {
      const filter = this.getAttribute('data-filter');
      filterButtons.forEach(btn => btn.classList.remove('active'));
      this.classList.add('active');
      currentFilter = filter;
      currentPage = 1; // Reset to first page on filter change
      renderGallery();
    });
  });

  function loadGallery() {
    galleryItemsDiv.innerHTML = `
      <div class="empty-state">
        <i class="fas fa-spinner fa-spin"></i>
        <h3>Loading wallpapers...</h3>
      </div>
    `;
    fetch('/api/wallpapers')
      .then(response => response.json())
      .then(data => {
        wallpapers = data;
        flatWallpapers = [];
        data.forEach(group => {
          if (Array.isArray(group.wallpapers)) {
            group.wallpapers.forEach(item => {
              flatWallpapers.push({
                ...item,
                type: group.type,
                mainCategory: group.mainCategory,
                subCategory: group.subCategory
              });
            });
          }
        });
        currentPage = 1; // Reset pagination on reload
        renderGallery();
      })
      .catch(error => {
        console.error('Error loading gallery:', error);
        galleryItemsDiv.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-exclamation-triangle"></i>
            <h3>Failed to load wallpapers</h3>
            <p>Please try refreshing the page</p>
          </div>
        `;
      });
  }

  function renderGallery() {
    galleryItemsDiv.innerHTML = '';
    paginationControls.innerHTML = '';
    const filteredWallpapers = currentFilter === 'all'
      ? flatWallpapers
      : flatWallpapers.filter(w => w.type === currentFilter);

    const totalItems = filteredWallpapers.length;
    const totalPages = Math.ceil(totalItems / itemsPerPage);
    if (currentPage > totalPages) currentPage = totalPages || 1;

    if (totalItems === 0) {
      galleryItemsDiv.innerHTML = `
        <div class="empty-state">
          <i class="fas fa-search"></i>
          <h3>No wallpapers found</h3>
          <p>Try changing your filter or upload new wallpapers</p>
        </div>
      `;
      paginationControls.innerHTML = '';
      return;
    }

    // Pagination slice
    const startIdx = (currentPage - 1) * itemsPerPage;
    const endIdx = startIdx + itemsPerPage;
    const wallpapersToShow = filteredWallpapers.slice(startIdx, endIdx);

    wallpapersToShow.forEach((wallpaper, index) => {
      const galleryItem = document.createElement('div');
      galleryItem.className = 'gallery-item';
      galleryItem.style.animationDelay = `${index * 0.1}s`;

      if (wallpaper.type === 'static') {
        galleryItem.innerHTML = `
          <div class="gallery-type">${wallpaper.type}</div>
          <img src="${wallpaper.fileUrl}" class="gallery-media" alt="${wallpaper.title}">
          <div class="gallery-info">
            <h3 class="gallery-title">${wallpaper.title}</h3>
            <div class="gallery-category">
              <span>${wallpaper.mainCategory?.name || ''}</span>
              <span class="category-badge">${wallpaper.subCategory?.name || ''}</span>
            </div>
          </div>
        `;
      } else {
        galleryItem.innerHTML = `
          <div class="gallery-type">${wallpaper.type}</div>
          <video src="${wallpaper.fileUrl}" class="gallery-media" muted preload="metadata" loop poster="${wallpaper.snapshotUrl ? wallpaper.snapshotUrl : ''}"></video>
          <div class="gallery-info">
            <h3 class="gallery-title">${wallpaper.title}</h3>
            <div class="gallery-category">
              <span>${wallpaper.mainCategory?.name || ''}</span>
              <span class="category-badge">${wallpaper.subCategory?.name || ''}</span>
            </div>
          </div>
        `;
      }

      galleryItemsDiv.appendChild(galleryItem);

      // Play/pause video on hover for live wallpapers
      if (wallpaper.type === 'live') {
        const video = galleryItem.querySelector('video');
        if (video) {
          galleryItem.addEventListener('mouseenter', () => {
            video.play().catch(() => {});
          });
          galleryItem.addEventListener('mouseleave', () => {
            video.pause();
            video.currentTime = 0;
          });
        }
      }
    });

    // Pagination controls
    if (totalPages > 1) {
      // Previous button
      const prevBtn = document.createElement('button');
      prevBtn.className = 'pagination-btn';
      prevBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
      prevBtn.disabled = currentPage === 1;
      prevBtn.onclick = () => { currentPage--; renderGallery(); };
      paginationControls.appendChild(prevBtn);

      // Page number buttons (show max 5: start, ..., current, ..., end)
      let pageRange = [];
      if (totalPages <= 5) {
        for (let i = 1; i <= totalPages; i++) pageRange.push(i);
      } else {
        if (currentPage <= 3) {
          pageRange = [1, 2, 3, 4, '...', totalPages];
        } else if (currentPage >= totalPages - 2) {
          pageRange = [1, '...', totalPages-3, totalPages-2, totalPages-1, totalPages];
        } else {
          pageRange = [1, '...', currentPage-1, currentPage, currentPage+1, '...', totalPages];
        }
      }
      pageRange.forEach(num => {
        if (num === '...') {
          const ellipsis = document.createElement('span');
          ellipsis.className = 'pagination-btn';
          ellipsis.textContent = '...';
          ellipsis.style.cursor = 'default';
          paginationControls.appendChild(ellipsis);
        } else {
          const pageBtn = document.createElement('button');
          pageBtn.className = 'pagination-btn' + (num === currentPage ? ' active' : '');
          pageBtn.textContent = num;
          pageBtn.disabled = num === currentPage;
          pageBtn.onclick = () => { currentPage = num; renderGallery(); };
          paginationControls.appendChild(pageBtn);
        }
      });

      // Next button
      const nextBtn = document.createElement('button');
      nextBtn.className = 'pagination-btn';
      nextBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
      nextBtn.disabled = currentPage === totalPages;
      nextBtn.onclick = () => { currentPage++; renderGallery(); };
      paginationControls.appendChild(nextBtn);
    }
  }

  loadGallery();
</script>
</body>
</html>